<?xml version="1.0" encoding="utf-8" ?>
<addon scheme="4.0">
    <id>queue</id>
    <name>Queue</name>
    <description>Provides queueing and scheduling of jobs with workers</description>
    <version>1.0</version>
    <priority>10</priority>
    <position>0</position>
    <status>active</status>
    <supplier>Best Brands</supplier>
    <supplier_link>https://github.com/best-brands</supplier_link>
    <default_language>en</default_language>

    <authors>
        <author>
            <name>Harm Smits</name>
            <email>harm@bestbrands.eu</email>
            <phone>+31625500655</phone>
        </author>
    </authors>

    <compatibility>
        <core_version>
            <min>4.11.5</min>
        </core_version>
        <php_version>
            <min>7.4.0</min>
        </php_version>
    </compatibility>

    <autoload>
        <psr4 prefix="Tygh\Addons\Queue\">src</psr4>
    </autoload>

    <bootstrap>\Tygh\Addons\Queue\Bootstrap</bootstrap>

    <queries>
        <item for="install">
            CREATE TABLE IF NOT EXISTS ?:queue_messages (
                id INT(11) NOT NULL AUTO_INCREMENT,
                queue_id varchar(64) NOT NULL,
                body LONGBLOB NOT NULL,
                consumer VARCHAR(255) DEFAULT NULL,
                timeout INT(11) DEFAULT NULL,
                read_on INT(11) DEFAULT NULL,
                inserted_on INT(11) NOT NULL,
                read_times INT(11) NOT NULL DEFAULT 0,
                PRIMARY KEY(id),
                KEY `queue_idx` (`queue_id`) USING BTREE
            ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;
        </item>
        <item for="install">
            ALTER TABLE ?:queue_messages ADD UNIQUE KEY `consumer_unique_name` (`consumer`);
        </item>
        <item for="uninstall">
            DROP TABLE IF EXISTS ?:queue_messages
        </item>
    </queries>
</addon>
