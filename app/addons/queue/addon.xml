<?xml version="1.0" encoding="utf-8" ?>
<addon scheme="4.0">
    <id>queue</id>
    <name>Queue</name>
    <description>Provides queueing and scheduling of jobs with workers</description>
    <version>1.0</version>
    <priority>10</priority>
    <position>0</position>
    <status>active</status>
    <supplier>Best Brands</supplier>
    <supplier_link>https://github.com/best-brands</supplier_link>
    <default_language>en</default_language>

    <authors>
        <author>
            <name>Harm Smits</name>
            <email>harm@bestbrands.eu</email>
            <phone>+31625500655</phone>
        </author>
    </authors>

    <compatibility>
        <core_version>
            <min>4.15.1</min>
        </core_version>
        <php_version>
            <min>7.4.0</min>
        </php_version>
    </compatibility>

    <autoload>
        <psr4 prefix="Tygh\Addons\Queue\">src</psr4>
    </autoload>

    <bootstrap>\Tygh\Addons\Queue\Bootstrap</bootstrap>

    <queries>
        <item for="install">
            CREATE TABLE IF NOT EXISTS ?:jobs (
                id BIGINT NOT NULL,
                queue VARCHAR(255) NOT NULL,
                payload LONGBLOB NOT NULL,
                attempts UNSIGNED INT NOT NULL DEFAULT 0,
                reserved_at TIMESTAMP,
                available_at TIMESTAMP NOT NULL,
                created_at TIMESTAMP NOT NULL,
                PRIMARY KEY (id),
                KEY (queue)
            ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;
        </item>
        <item for="uninstall">
            DROP TABLE IF EXISTS ?:jobs
        </item>

        <item for="install">
            CREATE TABLE IF NOT EXISTS ?:jobs_failed (
                id BIGINT NOT NULL,
                queue VARCHAR(255) NOT NULL,
                connection VARCHAR(255) NOT NULL,
                payload LONGTEXT NOT NULL,
                exception LONGTEXT NOT NULL,
                failed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP() NOT NULL,
                PRIMARY KEY(id)
            ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;
        </item>
        <item for="uninstall">
            DROP TABLE IF EXISTS ?:jobs_failed
        </item>
    </queries>
</addon>
